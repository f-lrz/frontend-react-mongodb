/**
 * Mock Service Worker (MSW) entry point.
 *
 * This file is precisely what the "msw init" command generates.
 * You can enhance it to match your application's needs.
 *
 * @see https://mswjs.io/docs/cli/init
 */

const INTEGRITY_CHECKSUM = "49b4c0bda14c2c53f06c1c3f592e3992";
const IS_MOCKED_BUILD = false;

/*
This file is generated by the "msw init" command.
It sets up a mock Service Worker that intercepts request
which enables you to mock network requests entirely on the client side.

You can remove this file at any time if you're not using MSW.
*/

// config/constants.js
const REQUEST = "request";
const RESPONSE = "response";
const CLIENT_URL = "http://localhost:5173";
const DEFAULT_AUTH_TOKEN = "DEFAULT_AUTH_TOKEN";

// src/utils/internal/getTimestamp.js
function getTimestamp() {
  const now = /* @__PURE__ */ new Date();
  return [
    String(now.getHours()).padStart(2, "0"),
    String(now.getMinutes()).padStart(2, "0"),
    String(now.getSeconds()).padStart(2, "0"),
    String(now.getMilliseconds()).padStart(3, "0")
  ].join(":");
}

// src/utils/internal/log.js
function log(level, ...message) {
  const timestamp = getTimestamp();
  const workerBadge = "%c[MSW]";
  const workerBadgeStyle = "color:orangered;font-weight:bold";
  console[level](
    `${workerBadge} %c${timestamp}`,
    workerBadgeStyle,
    "color:gray;font-weight:lighter",
    ...message
  );
}

// src/utils/handleRequest.js
async function handleRequest(request, clientId, options) {
  const {
    serviceWorker
  } = options;
  const url = new URL(request.url);
  url.searchParams.delete("mocker-id");
  const requestClone = request.clone();
  const getOriginalResponse = () => fetch(requestClone);
  const originalResponse = await getOriginalResponse();
  const rawOriginalResponse = originalResponse.clone();
  const responseData = {
    ...originalResponse,
    body: await rawOriginalResponse.text()
  };
  serviceWorker.clients.get(clientId).then((client) => {
    if (!client) {
      return;
    }
    client.postMessage({
      type: RESPONSE,
      payload: {
        request: {
          url: request.url
        },
        response: responseData
      }
    });
  });
  return originalResponse;
}

// src/serviceWorker.js
function setupServiceWorker(options) {
  const {
    serviceWorker
  } = options;
  serviceWorker.addEventListener("install", () => {
    serviceWorker.skipWaiting();
  });
  serviceWorker.addEventListener("activate", (event) => {
    event.waitUntil(serviceWorker.clients.claim());
  });
  serviceWorker.addEventListener("message", (event) => {
    if (event.data === "MOCK_ACTIVATE") {
      return;
    }
    if (event.data?.type === REQUEST) {
      const {
        id,
        payload
      } = event.data;
      const {
        url,
        options: options2
      } = payload;
      handleRequest(new Request(url, options2), id, options);
    }
  });
  serviceWorker.addEventListener("fetch", (event) => {
    const {
      request
    } = event;
    const url = new URL(request.url);
    if (url.searchParams.has("mocker-id")) {
      return event.respondWith(
        handleRequest(request, url.searchParams.get("mocker-id"), options)
      );
    }
  });
}
setupServiceWorker({
  serviceWorker: self,
  IS_MOCKED_BUILD
});